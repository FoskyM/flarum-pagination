(()=>{var t={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return t.d(o,{a:o}),o},d:(n,o)=>{for(var e in o)t.o(o,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:o[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";function o(){return o=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}return t},o.apply(this,arguments)}t.r(n);const e=flarum.core.compat["common/app"];var a=t.n(e);const i=flarum.core.compat.extend,s=flarum.core.compat["forum/components/DiscussionList"];var r=t.n(s);const u=flarum.core.compat["forum/states/DiscussionListState"];var c=t.n(u);const p=flarum.core.compat["forum/components/DiscussionListItem"];var g=t.n(p);const l=flarum.core.compat["common/components/Placeholder"];var f=t.n(l);const d=flarum.core.compat["common/components/Button"];var h=t.n(d);const P=flarum.core.compat["common/utils/Stream"];var v=t.n(P);const b=flarum.core.compat["forum/components/DiscussionComposer"];var y=t.n(b);const k=flarum.core.compat["forum/utils/DiscussionControls"];var L=t.n(k);const I=flarum.core.compat["forum/app"];var x=t.n(I);const M=flarum.core.compat["common/extend"],O=flarum.core.compat["forum/components/SettingsPage"];var N=t.n(O);const C=flarum.core.compat["common/components/FieldSet"];var B=t.n(C);const _=flarum.core.compat["common/utils/ItemList"];var w=t.n(_);const S=flarum.core.compat["common/components/Switch"];var j=t.n(S);a().initializers.add("foskym/flarum-pagination",(function(){(0,M.extend)(N().prototype,"oninit",(function(){var t=this.user.preferences();this.userCustom=v()(t["foskym-pagination.userCustom"]),this.userPaginationOnLoading=v()(t["foskym-pagination.userPaginationOnLoading"])})),(0,M.extend)(N().prototype,"settingsItems",(function(t){Boolean(x().forum.attribute("foskym-pagination.canUserPref"))&&t.add("pagination_settings",B().component({label:x().translator.trans("foskym-pagination.forum.user.settings.head"),className:"SettingsPage-pagination"},this.Pagination_UserPrefItems().toArray()))})),N().prototype.Pagination_UserPrefItems=function(){var t=this,n=new(w());return n.add("foskym-pagination.userCustom",j().component({state:this.user.preferences()["foskym-pagination.userCustom"],onchange:function(n){t.UserCustom_Loading=!0,t.user.savePreferences({"foskym-pagination.userCustom":n}).then((function(){t.UserCustom_Loading=!1,m.redraw()}))},loading:this.UserCustom_Loading},x().translator.trans("foskym-pagination.forum.user.settings.userCustom"))),this.user.preferences()["foskym-pagination.userCustom"]&&n.add("foskym-pagination.userPaginationOnLoading",j().component({state:this.user.preferences()["foskym-pagination.userPaginationOnLoading"],onchange:function(n){t.userPaginationOnLoading_Loading=!0,t.user.savePreferences({"foskym-pagination.userPaginationOnLoading":n}).then((function(){t.userPaginationOnLoading_Loading=!1,m.redraw()}))},loading:this.userPaginationOnLoading_Loading},x().translator.trans("foskym-pagination.forum.user.settings.userPaginationOnLoading"))),n},(0,i.override)(c().prototype,"refresh",(function(t,n){var o=this;return void 0===n&&(n=1),this.options={perPage:a().forum.attribute("foskym-pagination.perPage"),perLoadMore:a().forum.attribute("foskym-pagination.perLoadMore"),perIndexInit:a().forum.attribute("foskym-pagination.perIndexInit"),leftEdges:4,rightEdges:5},this.usePaginationMode=function(){if(null===x().session.user)return x().forum.attribute("foskym-pagination.paginationOnLoading");var t=x().session.user.preferences();return x().forum.attribute("foskym-pagination.canUserPref")&&t["foskym-pagination.userCustom"]?!!t["foskym-pagination.userPaginationOnLoading"]:x().forum.attribute("foskym-pagination.paginationOnLoading")}(),this.usePaginationMode?(this.initialLoading=!0,this.loadingPrev=!1,this.loadingNext=!1,this.clear(),this.location={page:n},this.loadPage(n).then((function(t){o.pages=[],o.parseResults(o.location.page,t)})).finally((function(){return o.initialLoading=!1}))):(this.pageSize=this.options.perLoadMore,t(n))})),(0,i.override)(c().prototype,"loadPage",(function(t,n){void 0===n&&(n=1);var e,i,s=this.requestParams(),r=Array.isArray(s.include)?s.include.join(","):s.include;this.usePaginationMode?(e=this.options.perPage*(n-1),i=this.options.perPage):i=0==(e=this.options.perIndexInit*Math.min(n-1,1)+this.options.perLoadMore*Math.max(n-2,0))?this.options.perIndexInit:this.options.perLoadMore;var u=o({},s,{page:o({},s.page,{offset:e,limit:i}),include:r});return a().store.find(this.type,u)})),(0,i.override)(c().prototype,"parseResults",(function(t,n,o){var e;if(!this.usePaginationMode)return t(n,o);var a=Number(n),i=(null==(e=o.payload)?void 0:e.links)||{},s={number:a,items:o,hasNext:!(null==i||!i.next),hasPrev:!(null==i||!i.prev)};this.hasPage=function(t){var n=this.getPages();if(0==n.length)return!1;for(var o=0;o<n.length;o++)if(n[o].number==t)return!0;return!1},this.hasPage(a)||this.pages.push(s),this.location={page:a},this.totalDiscussionCount=v()(o.payload.jsonapi.totalResultsCount),this.getTotalPages=function(){return Math.ceil(this.totalDiscussionCount()/this.options.perPage)},this.page=v()(s),this.perPage=v()(this.options.perPage),this.totalPages=v()(this.getTotalPages()),this.ctrl={prevPage:function(){var t=this.page().number;if(!(--t<1)){this.page(t);var n=t;this.loadPage(n).then(this.parseResults.bind(this,n))}}.bind(this),nextPage:function(){var t=this.page().number;if(++t>this.totalPages())t=this.totalPages();else{this.page(t);var n=t;this.loadPage(n).then(this.parseResults.bind(this,n))}}.bind(this),toPage:function(t){if(!(this.page().number==Number(t)||t<1||t>this.totalPages())){this.page(Number(t));var n=Number(t);this.loadPage(n).then(this.parseResults.bind(this,n))}}.bind(this),pageList:function(){for(var t=[],n=Math.max(parseInt(this.page().number)-this.options.leftEdges,1),o=Math.min(parseInt(this.page().number)+this.options.rightEdges,this.totalPages()),e=n;e<=o;e++)t.push(e);return t}.bind(this)},m.redraw()})),(0,i.extend)(r().prototype,"view",(function(t){var n=this.attrs.state;if(n.usePaginationMode){var o,e=n.getParams();if(n.isEmpty()){var i=a().translator.trans("core.forum.discussion_list.empty_text");return o=f().component({text:i}),t.children=[],void t.children.push(o)}if(!n.isLoading()){for(var s=function(){var t=parseInt(document.getElementById("pagination-inputJump").value);Number.isFinite(t)&&Number.isSafeInteger(t)&&t!=n.page().number&&1<=t&&t<=n.totalPages()&&n.ctrl.toPage(t)},r=[],u=n.getPages(),c=0;c<u.length;c++){var p=u[c];if(p.number==n.location.page){p.items.map((function(t){r.push(m("li",{key:t.id(),"data-id":t.id()},g().component({discussion:t,params:e})))}));break}}o=m("ul",{className:"DiscussionList-discussions"},r.map((function(t){return t}))),t.children=[],t.children.push(o);var l,d,P=h().component({title:"First",icon:"fa fa-angle-double-left",className:"Button Button--icon",onclick:function(){n.ctrl.toPage(1)}}),v=h().component({title:"Back",icon:"fa fa-angle-left",className:"Button Button--icon",onclick:function(){var t=n.page().number;n.ctrl.toPage(parseInt(t)-1)}}),b=h().component({title:"Next",icon:"fa fa-angle-right",className:"Button Button--icon",onclick:function(){var t=n.page().number;n.ctrl.toPage(parseInt(t)+1)}}),y=h().component({title:"Last",icon:"fa fa-angle-double-right",className:"Button Button--icon",onclick:function(){var t=parseInt(n.totalPages());n.ctrl.toPage(parseInt(t))}}),k=m("input.FromControl",{id:"pagination-inputJump",placeholder:void 0===n.page().number?"":""+n.page().number,onkeydown:function(t){t.redraw=!1,13==t.keyCode&&(t.redraw=!0,s())}}),L=h().component({title:"Jump",icon:"fas fa-paper-plane",className:"Button Button--icon",onclick:s}),I=[];n.ctrl.pageList().map((function(t){var n=this;I.push(h().component({title:parseInt(t),icon:"",className:t==n.page().number?"Button Button--primary":"Button","data-page":t,onclick:t!=n.page().number?function(){n.ctrl.toPage(parseInt(t))}:""},m("strong",{className:""},parseInt(t))))}),n),l=[P].concat(v,I,b,y,k,L),d={view:function(t){return m("div",{id:"toolbar"+Math.floor(10*Math.random()+1),className:"Pagination"},m("ul",{class:"IndexPage-toolbar-view"},t.attrs.groupbuttons.map((function(t){return m("li",{class:""},t)}))))}},"above"==a().forum.attribute("foskym-pagination.paginationPosition")&&!n.isLoading()&&t.children.unshift(m(d,{groupbuttons:l})),"under"==a().forum.attribute("foskym-pagination.paginationPosition")&&!n.isLoading()&&t.children.push(m(d,{groupbuttons:l})),"both"==a().forum.attribute("foskym-pagination.paginationPosition")&&!n.isLoading()&&t.children.unshift(m(d,{groupbuttons:l}))&&t.children.push(m(d,{groupbuttons:l}))}}})),(0,i.extend)(L(),"deleteAction",(function(){if(this.usePaginationMode&&a().discussions){var t=a().discussions.location.page;a().discussions.refresh(t)}})),(0,i.extend)(y().prototype,"onsubmit",(function(){this.usePaginationMode&&a().discussions&&a().discussions.refresh()}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map