(()=>{var t={n:n=>{var s=n&&n.__esModule?()=>n.default:()=>n;return t.d(s,{a:s}),s},d:(n,s)=>{for(var i in s)t.o(s,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:s[i]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const s=flarum.core.compat["common/app"];var i=t.n(s);const o=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/DiscussionComposer"];var a=t.n(e);const r=flarum.core.compat["forum/utils/DiscussionControls"];var u=t.n(r);const c=flarum.core.compat["forum/app"];var l=t.n(c);const p=flarum.core.compat["forum/components/SettingsPage"];var g=t.n(p);const f=flarum.core.compat["common/components/FieldSet"];var h=t.n(f);const d=flarum.core.compat["common/utils/ItemList"];var v=t.n(d);const P=flarum.core.compat["common/components/Switch"];var b=t.n(P);const y=flarum.core.compat["common/utils/Stream"];var L=t.n(y);function k(){return k=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},k.apply(this,arguments)}const O=flarum.core.compat["forum/states/DiscussionListState"];var C=t.n(O);const D=flarum.core.compat["forum/components/DiscussionList"];var N=t.n(D);const I=flarum.core.compat["forum/components/DiscussionListItem"];var x=t.n(I);const M=flarum.core.compat["common/components/Placeholder"];var R=t.n(M);const B=flarum.core.compat["common/components/LoadingIndicator"];var _=t.n(B);const S=flarum.core.compat["common/utils/classList"];var w=t.n(S);function j(t,n){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},j(t,n)}const J=flarum.core.compat["common/Component"];var T=t.n(J);const q=flarum.core.compat["common/components/Button"];var F=t.n(q),U=function(t){var n,s;function i(){for(var n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).attrs=void 0,n}s=t,(n=i).prototype=Object.create(s.prototype),n.prototype.constructor=n,j(n,s);var o=i.prototype;return o.view=function(t){var n=this.attrs.state;return m("div",{className:"Pagination"},m("ul",{class:"IndexPage-toolbar-view"},m("li",null,this.buttonFirst()),m("li",null,this.buttonBack()),n.ctrl.pageList().map((function(t){return m("li",null,m(F(),{title:t,className:n.page().number==t?"Button Button--primary Button--active":"Button",onclick:function(){n.ctrl.toPage(t)}},t))})),m("li",null,this.buttonNext()),m("li",null,this.buttonLast()),m("li",null,this.inputJump()),m("li",null,this.buttonJump())))},o.buttonFirst=function(){var t=this.attrs.state;return F().component({title:"First",icon:"fa fa-angle-double-left",className:"Button Button--icon",onclick:function(){t.ctrl.toPage(1)},disabled:1==t.page().number})},o.buttonBack=function(){var t=this.attrs.state;return F().component({title:"Back",icon:"fa fa-angle-left",className:"Button Button--icon",onclick:function(){var n=t.page().number;t.ctrl.toPage(parseInt(n)-1)},disabled:1==t.page().number})},o.buttonNext=function(){var t=this.attrs.state;return F().component({title:"Next",icon:"fa fa-angle-right",className:"Button Button--icon",onclick:function(){var n=t.page().number;t.ctrl.toPage(parseInt(n)+1)},disabled:t.page().number==t.totalPages()})},o.buttonLast=function(){var t=this.attrs.state;return F().component({title:"Last",icon:"fa fa-angle-double-right",className:"Button Button--icon",onclick:function(){var n=parseInt(t.totalPages());t.ctrl.toPage(n)},disabled:t.page().number==t.totalPages()})},o.JumpFunc=function(){var t,n=this.attrs.state,s=parseInt(null==(t=document.getElementById("pagination-inputJump"))?void 0:t.value);Number.isFinite(s)&&Number.isSafeInteger(s)&&s!=n.page().number&&1<=s&&s<=n.totalPages()&&n.ctrl.toPage(s)},o.inputJump=function(){var t=this,n=this.attrs.state;return m("input.FromControl",{id:"pagination-inputJump",placeholder:void 0===n.page().number?"":""+n.page().number,onkeydown:function(n){n.redraw=!1,13==n.keyCode&&(n.redraw=!0,t.JumpFunc())}})},o.buttonJump=function(){return F().component({title:"Jump",icon:"fa fa-paper-plane",className:"Button Button--icon",onclick:this.JumpFunc.bind(this)})},i}(T());i().initializers.add("foskym/flarum-pagination",(function(){(0,o.extend)(g().prototype,"oninit",(function(){var t=this.user.preferences();this.userCustom=L()(t["foskym-pagination.userCustom"]),this.userPaginationOnLoading=L()(t["foskym-pagination.userPaginationOnLoading"])})),(0,o.extend)(g().prototype,"settingsItems",(function(t){Boolean(l().forum.attribute("foskym-pagination.canUserPref"))&&t.add("pagination_settings",h().component({label:l().translator.trans("foskym-pagination.forum.user.settings.head"),className:"SettingsPage-pagination"},this.Pagination_UserPrefItems().toArray()))})),g().prototype.Pagination_UserPrefItems=function(){var t=this,n=new(v());return n.add("foskym-pagination.userCustom",b().component({state:this.user.preferences()["foskym-pagination.userCustom"],onchange:function(n){t.UserCustom_Loading=!0,t.user.savePreferences({"foskym-pagination.userCustom":n}).then((function(){t.UserCustom_Loading=!1,m.redraw()}))},loading:this.UserCustom_Loading},l().translator.trans("foskym-pagination.forum.user.settings.userCustom"))),this.user.preferences()["foskym-pagination.userCustom"]&&n.add("foskym-pagination.userPaginationOnLoading",b().component({state:this.user.preferences()["foskym-pagination.userPaginationOnLoading"],onchange:function(n){t.userPaginationOnLoading_Loading=!0,t.user.savePreferences({"foskym-pagination.userPaginationOnLoading":n}).then((function(){t.userPaginationOnLoading_Loading=!1,m.redraw()}))},loading:this.userPaginationOnLoading_Loading},l().translator.trans("foskym-pagination.forum.user.settings.userPaginationOnLoading"))),n},C().prototype.initOptions=function(){this.options={perPage:i().forum.attribute("foskym-pagination.perPage"),perLoadMore:i().forum.attribute("foskym-pagination.perLoadMore"),perIndexInit:i().forum.attribute("foskym-pagination.perIndexInit"),leftEdges:4,rightEdges:5},this.usePaginationMode=function(){if(null===l().session.user)return l().forum.attribute("foskym-pagination.paginationOnLoading");var t=l().session.user.preferences();return l().forum.attribute("foskym-pagination.canUserPref")&&t["foskym-pagination.userCustom"]?!!t["foskym-pagination.userPaginationOnLoading"]:l().forum.attribute("foskym-pagination.paginationOnLoading")}(),this.lastTotalDiscussionCount=0,this.lastTotalPages=0,this.lastDiscussions=[],this.lastLoadedPage={},this.lastRquestParams={},this.optionInited=!0},(0,o.override)(C().prototype,"refresh",(function(t,n){var s=this;return void 0===n&&(n=1),this.optionInited||this.initOptions(),this.usePaginationMode?(this.initialLoading=!0,this.loadingPrev=!1,this.loadingNext=!1,this.isRefreshing=!0,this.clear(),this.location={page:n},this.loadPage(n).then((function(t){s.pages=[],s.parseResults(s.location.page,t)})).finally((function(){s.initialLoading=!1,s.isRefreshing=!1}))):(this.pageSize=this.options.perLoadMore,t(n))})),(0,o.override)(C().prototype,"loadPage",(function(t,n){void 0===n&&(n=1);var s=this.requestParams();if(this.optionInited||this.initOptions(),this.lastRquestParams.include||(this.lastRquestParams=s),!this.isRefreshing&&(JSON.stringify(s.include)!==JSON.stringify(this.lastRquestParams.include)||s["filter.q"]===this.lastRquestParams["filter.q"]||s.sort===this.lastRquestParams.sort)&&this.lastLoadedPage[n]){var o=this.options.perPage*(n-1),e=this.options.perPage*n,a=this.lastDiscussions.slice(o,e);return a.payload={jsonapi:{totalResultsCount:this.totalDiscussionCount()}},Promise.resolve(a)}var r,u,c=Array.isArray(s.include)?s.include.join(","):s.include;this.usePaginationMode?(r=this.options.perPage*(n-1),u=this.options.perPage):u=0==(r=this.options.perIndexInit*Math.min(n-1,1)+this.options.perLoadMore*Math.max(n-2,0))?this.options.perIndexInit:this.options.perLoadMore;var l=k({},s,{page:k({},s.page,{offset:r,limit:u}),include:c});return i().store.find(this.type,l)})),(0,o.override)(C().prototype,"parseResults",(function(t,n,s){var i;if(!this.usePaginationMode)return t(n,s);var o=Number(n),e=(null==(i=s.payload)?void 0:i.links)||{},a={number:o,items:s,hasNext:!(null==e||!e.next),hasPrev:!(null==e||!e.prev)};if(this.hasPage=function(t){var n=this.getPages();if(0==n.length)return!1;for(var s=0;s<n.length;s++)if(n[s].number==t)return!0;return!1},this.hasPage(o)||this.pages.push(a),this.location={page:o},this.totalDiscussionCount=L()(s.payload.jsonapi.totalResultsCount),!(this.lastTotalDiscussionCount!=this.totalDiscussionCount()&&0!=this.lastTotalDiscussionCount||0===this.lastTotalDiscussionCount||this.isRefreshing)){var r;this.page=L()(a),this.lastLoadedPage[o]=a;var u=this.options.perPage*(o-1),c=this.options.perPage*o;return(r=this.lastDiscussions).splice.apply(r,[u,c-u].concat(s)),void m.redraw()}this.lastTotalDiscussionCount=this.totalDiscussionCount();for(var l=0;l<this.lastTotalDiscussionCount;l++)this.lastDiscussions[l]={};this.lastLoadedPage={},this.getTotalPages=function(){return Math.ceil(this.totalDiscussionCount()/this.options.perPage)},this.page=L()(a),this.perPage=L()(this.options.perPage),this.totalPages=L()(this.getTotalPages()),this.ctrl={prevPage:function(){var t=this,n=this.page().number;if(!(--n<1)){this.page(n);var s=n;this.loadingPrev=!0,this.loadPage(s).then((function(n){t.parseResults(s,n),t.loadingPrev=!1}))}}.bind(this),nextPage:function(){var t=this,n=this.page().number;if(++n>this.totalPages())n=this.totalPages();else{this.page(n);var s=n;this.loadingNext=!0,this.loadPage(s).then((function(n){t.parseResults(s,n),t.loadingNext=!1}))}}.bind(this),toPage:function(t){var n=this;if(!(this.page().number==Number(t)||t<1||t>this.totalPages())){this.page(Number(t));var s=Number(t);this.initialLoading=!0,this.loadPage(s).then((function(t){n.parseResults(s,t),n.initialLoading=!1}))}}.bind(this),pageList:function(){for(var t=[],n=Math.max(parseInt(this.page().number)-this.options.leftEdges,1),s=Math.min(parseInt(this.page().number)+this.options.rightEdges,this.totalPages()),i=n;i<=s;i++)t.push(i);return t}.bind(this)},m.redraw()})),(0,o.override)(C().prototype,"addDiscussion",(function(t){})),(0,o.override)(N().prototype,"view",(function(t){var n=this.attrs.state;if(!n.usePaginationMode)return t();var s=n.getParams(),o=n.isLoading();if(n.isEmpty()){var e=i().translator.trans("core.forum.discussion_list.empty_text");return m("div",{className:"DiscussionList"},m(R(),{text:e}))}if(o)return m("div",{className:w()("DiscussionList",{"DiscussionList--searchResults":n.isSearchResults()})},m("ul",{role:"feed","aria-busy":o,className:"DiscussionList-discussions"}),m("div",{className:"DiscussionList-loadMore"},m(_(),null)));for(var a=n.getPages(),r=[],u=0;u<a.length;u++){var c=a[u];if(c.number==n.location.page){r=c.items;break}}var l=U.component({state:n}),p=i().forum.attribute("foskym-pagination.paginationPosition"),g=n.options.perPage,f=n.page;return m("div",{className:w()("DiscussionList",{"DiscussionList--searchResults":n.isSearchResults()})},"above"==p||"both"==p?l:"",m("ul",{role:"feed","aria-busy":o,className:"DiscussionList-discussions"},r.map((function(t,n){return m("li",{key:t.id(),"data-id":t.id(),role:"article","aria-setsize":"-1","aria-posinset":f*g+n},m(x(),{discussion:t,params:s}))}))),"under"==p||"both"==p?l:"")})),(0,o.extend)(u(),"deleteAction",(function(){if(this.usePaginationMode&&i().discussions){var t=i().discussions.location.page;i().discussions.refresh(t)}})),(0,o.extend)(a().prototype,"onsubmit",(function(){this.usePaginationMode&&i().discussions&&i().discussions.refresh()}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map