(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},n.apply(this,arguments)}t.r(e);const a=flarum.core.compat.extend,i=flarum.core.compat["components/DiscussionList"];var o=t.n(i);const s=flarum.core.compat["states/DiscussionListState"];var r=t.n(s);const u=flarum.core.compat["components/DiscussionListItem"];var c=t.n(u);const p=flarum.core.compat["common/components/Placeholder"];var l=t.n(p);const g=flarum.core.compat["common/components/Button"];var f=t.n(g);const h=flarum.core.compat["common/utils/Stream"];var d=t.n(h);const P=flarum.core.compat["components/DiscussionComposer"];var v=t.n(P);const b=flarum.core.compat["utils/DiscussionControls"];var L=t.n(b);const y=flarum.core.compat["forum/app"];var _=t.n(y);const D=flarum.core.compat["common/extend"],I=flarum.core.compat["forum/components/SettingsPage"];var U=t.n(I);const B=flarum.core.compat["common/components/FieldSet"];var N=t.n(B);const x=flarum.core.compat["common/utils/ItemList"];var M=t.n(x);const C=flarum.core.compat["common/components/Switch"];var F=t.n(C);function w(){if(Boolean(_().forum.attribute("LrysiaPagination.CanUserPref"))){if(Boolean(_().session.user.preferences().DLP_UserCustom)){if(!Boolean(_().session.user.preferences().DLP_UserPaginationFirst))return!1}else if(!Boolean(_().forum.attribute("LrysiaPagination.PaginationFirst")))return!1}else if(!Boolean(_().forum.attribute("LrysiaPagination.PaginationFirst")))return!1;return!0}app.initializers.add("lrysia/pagination",(function(){(0,D.extend)(U().prototype,"oninit",(function(){this.DLP_UserCustom=d()(this.user.preferences().DLP_UserCustom),this.DLP_UserPaginationFirst=d()(this.user.preferences().DLP_UserPaginationFirst)})),(0,D.extend)(U().prototype,"settingsItems",(function(t){Boolean(_().forum.attribute("LrysiaPagination.CanUserPref"))&&t.add("Lrysia_DLP_User",N().component({label:_().translator.trans("Lrysia-DLP.forum.user.settings.Head"),className:"Lrysia_DLP_PrefSettings"},this.Lrysia_DLP_UserPrefItems().toArray()))})),U().prototype.Lrysia_DLP_UserPrefItems=function(){var t=this,e=new(M());return e.add("Lrysia_DLP_UserCustom",F().component({state:this.user.preferences().DLP_UserCustom,onchange:function(e){t.UserCustomLoading=!0,t.user.savePreferences({DLP_UserCustom:e}).then((function(){t.UserCustomLoading=!1,m.redraw()}))},loading:this.UserCustomLoading},_().translator.trans("Lrysia-DLP.forum.user.settings.DLP_UserCustom"))),this.user.preferences().DLP_UserCustom&&e.add("Lrysia_DLP_UserPaginationFirst",F().component({state:this.user.preferences().DLP_UserPaginationFirst,onchange:function(e){t.UserPaginationFirstLoading=!0,t.user.savePreferences({DLP_UserPaginationFirst:e}).then((function(){t.UserPaginationFirstLoading=!1,m.redraw()}))},loading:this.UserPaginationFirstLoading},_().translator.trans("Lrysia-DLP.forum.user.settings.DLP_UserPaginationFirst"))),e},(0,a.override)(r().prototype,"refresh",(function(t){var e=this;if(this.options={perPage:Number(app.forum.attribute("LrysiaPagination.PerPage")),perLoadMore:Number(app.forum.attribute("LrysiaPagination.PerLoadMore")),perIndexInit:Number(app.forum.attribute("LrysiaPagination.PerIndexInit")),leftEdges:4,rightEdges:5},this.usePaginationMode=w(),!this.usePaginationMode)return this.pageSize=this.options.perLoadMore,t(arguments[1]);this.initialLoading=!0,this.loadingPrev=!1,this.loadingNext=!1;var n=arguments[1]||1;return this.clear(),this.location={page:n},this.loadPage(n).then((function(t){e.pages=[],e.parseResults(e.location.page,t)})).finally((function(){return e.initialLoading=!1}))})),(0,a.override)(r().prototype,"loadPage",(function(t){var e,a,i=void 0===arguments[1]?1:arguments[1],o=this.requestParams(),s=Array.isArray(o.include)?o.include.join(","):o.include;this.usePaginationMode?(e=this.options.perPage*(i-1),a=this.options.perPage):a=0==(e=this.options.perIndexInit*Math.min(i-1,1)+this.options.perLoadMore*Math.max(i-2,0))?this.options.perIndexInit:this.options.perLoadMore;var r=n({},o,{page:n({},o.page,{offset:e,limit:a}),include:s});return app.store.find(this.type,r)})),(0,a.override)(r().prototype,"parseResults",(function(t){var e;if(!this.usePaginationMode)return t(arguments[1],arguments[2]);var n=Number(arguments[1]),a=(null==(e=arguments[2].payload)?void 0:e.links)||{},i={number:n,items:arguments[2],hasNext:!(null==a||!a.next),hasPrev:!(null==a||!a.prev)};this.hasPage=function(t){var e=this.getPages();if(0==e.length)return!1;for(var n=0;n<e.length;n++)if(e[n].number==t)return!0;return!1},this.hasPage(n)||this.pages.push(i),this.location={page:n},this.totalDiscussionCount=d()(arguments[2].payload.jsonapi.totalResultsCount),this.getTotalPages=function(){return Math.ceil(this.totalDiscussionCount()/this.options.perPage)},this.page=d()(i),this.perPage=d()(this.options.perPage),this.totalPages=d()(this.getTotalPages()),this.ctrl={prevPage:function(){var t=this.page().number;if(!(--t<1)){this.page(t);var e=t;this.loadPage(e).then(this.parseResults.bind(this,e))}}.bind(this),nextPage:function(){var t=this.page().number;if(++t>this.totalPages())t=this.totalPages();else{this.page(t);var e=t;this.loadPage(e).then(this.parseResults.bind(this,e))}}.bind(this),toPage:function(t){if(!(this.page().number==Number(t)||t<1||t>this.totalPages())){this.page(Number(t));var e=Number(t);this.loadPage(e).then(this.parseResults.bind(this,e))}}.bind(this),pageList:function(){for(var t=[],e=Math.max(parseInt(this.page().number)-this.options.leftEdges,1),n=Math.min(parseInt(this.page().number)+this.options.rightEdges,this.totalPages()),a=e;a<=n;a++)t.push(a);return t}.bind(this)},m.redraw()})),(0,a.extend)(o().prototype,"view",(function(t){var e=this.attrs.state;if(e.usePaginationMode){var n,a=e.getParams();if(e.isEmpty()){var i=app.translator.trans("core.forum.discussion_list.empty_text");return n=l().component({text:i}),t.children=[],void t.children.push(n)}if(!e.isLoading()){for(var o=function(){var t=parseInt(document.getElementById("lrysia-inputJump").value);Number.isFinite(t)&&Number.isSafeInteger(t)&&t!=e.page().number&&1<=t&&t<=e.totalPages()&&e.ctrl.toPage(t)},s=[],r=e.getPages(),u=0;u<r.length;u++){var p=r[u];if(p.number==e.location.page){p.items.map((function(t){s.push(m("li",{key:t.id(),"data-id":t.id()},c().component({discussion:t,params:a})))}));break}}n=m("ul",{className:"DiscussionList-discussions"},s.map((function(t){return t}))),t.children=[],t.children.push(n);var g,h,d=f().component({title:"First",icon:"fa fa-angle-double-left",className:"Button Button--icon",onclick:function(){e.ctrl.toPage(1)}}),P=f().component({title:"Back",icon:"fa fa-angle-left",className:"Button Button--icon",onclick:function(){var t=e.page().number;e.ctrl.toPage(parseInt(t)-1)}}),v=f().component({title:"Next",icon:"fa fa-angle-right",className:"Button Button--icon",onclick:function(){var t=e.page().number;e.ctrl.toPage(parseInt(t)+1)}}),b=f().component({title:"Last",icon:"fa fa-angle-double-right",className:"Button Button--icon",onclick:function(){var t=parseInt(e.totalPages());e.ctrl.toPage(parseInt(t))}}),L=m("input.FromControl",{id:"lrysia-inputJump",placeholder:void 0===e.page().number?"":""+e.page().number,onkeydown:function(t){t.redraw=!1,13==t.keyCode&&(t.redraw=!0,o())}}),y=f().component({title:"Jump",icon:"fas fa-paper-plane",className:"Button Button--icon",onclick:o}),_=[];e.ctrl.pageList().map((function(t){var e=this;_.push(f().component({title:parseInt(t),icon:"",className:t==e.page().number?"Button Button--primary":"Button","data-page":t,onclick:t!=e.page().number?function(){e.ctrl.toPage(parseInt(t))}:""},m("strong",{className:""},parseInt(t))))}),e),g=[d].concat(P,_,v,b,L,y),h={view:function(t){return m("div",{id:"toolbar"+Math.floor(10*Math.random()+1),className:"Pagination"},m("ul",{class:"IndexPage-toolbar-view"},t.attrs.groupbuttons.map((function(t){return m("li",{class:""},t)}))))}},"above"==app.forum.attribute("LrysiaPagination.NavBarPosition")&&!e.isLoading()&&t.children.unshift(m(h,{groupbuttons:g})),"under"==app.forum.attribute("LrysiaPagination.NavBarPosition")&&!e.isLoading()&&t.children.push(m(h,{groupbuttons:g})),"both"==app.forum.attribute("LrysiaPagination.NavBarPosition")&&!e.isLoading()&&t.children.unshift(m(h,{groupbuttons:g}))&&t.children.push(m(h,{groupbuttons:g}))}}})),(0,a.extend)(L(),"deleteAction",(function(){if(this.usePaginationMode&&app.discussions){var t=app.discussions.location.page;app.discussions.refresh(t)}})),(0,a.extend)(v().prototype,"onsubmit",(function(){this.usePaginationMode&&app.discussions&&app.discussions.refresh()}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map