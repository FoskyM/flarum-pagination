(()=>{var t={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return t.d(o,{a:o}),o},d:(n,o)=>{for(var e in o)t.o(o,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:o[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";function o(){return o=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}return t},o.apply(this,arguments)}t.r(n);const e=flarum.core.compat["common/app"];var i=t.n(e);const a=flarum.core.compat.extend,s=flarum.core.compat["forum/components/DiscussionList"];var r=t.n(s);const u=flarum.core.compat["forum/states/DiscussionListState"];var c=t.n(u);const p=flarum.core.compat["forum/components/DiscussionListItem"];var l=t.n(p);const g=flarum.core.compat["common/components/Placeholder"];var f=t.n(g);const d=flarum.core.compat["common/components/Button"];var h=t.n(d);const v=flarum.core.compat["common/utils/Stream"];var P=t.n(v);const b=flarum.core.compat["forum/components/DiscussionComposer"];var y=t.n(b);const L=flarum.core.compat["forum/utils/DiscussionControls"];var k=t.n(L);const O=flarum.core.compat["common/components/LoadingIndicator"];var N=t.n(O);const x=flarum.core.compat["common/utils/classList"];var I=t.n(x);const M=flarum.core.compat["forum/app"];var B=t.n(M);const C=flarum.core.compat["common/extend"],_=flarum.core.compat["forum/components/SettingsPage"];var D=t.n(_);const S=flarum.core.compat["common/components/FieldSet"];var w=t.n(S);const j=flarum.core.compat["common/utils/ItemList"];var J=t.n(j);const R=flarum.core.compat["common/components/Switch"];var F=t.n(R);function U(t,n){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},U(t,n)}const E=flarum.core.compat["common/Component"];var A=function(t){var n,o;function e(){for(var n,o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return(n=t.call.apply(t,[this].concat(e))||this).attrs=void 0,n}o=t,(n=e).prototype=Object.create(o.prototype),n.prototype.constructor=n,U(n,o);var i=e.prototype;return i.view=function(t){var n=this.attrs.state;return m("div",{className:"Pagination"},m("ul",{class:"IndexPage-toolbar-view"},m("li",null,this.buttonFirst()),m("li",null,this.buttonBack()),n.ctrl.pageList().map((function(t){return m("li",null,m(h(),{title:t,className:n.page().number==t?"Button Button--primary Button--active":"Button",onclick:function(){n.ctrl.toPage(t)}},t))})),m("li",null,this.buttonNext()),m("li",null,this.buttonLast()),m("li",null,this.inputJump()),m("li",null,this.buttonJump())))},i.buttonFirst=function(){var t=this.attrs.state;return h().component({title:"First",icon:"fa fa-angle-double-left",className:"Button Button--icon",onclick:function(){t.ctrl.toPage(1)},disabled:1==t.page().number})},i.buttonBack=function(){var t=this.attrs.state;return h().component({title:"Back",icon:"fa fa-angle-left",className:"Button Button--icon",onclick:function(){var n=t.page().number;t.ctrl.toPage(parseInt(n)-1)},disabled:1==t.page().number})},i.buttonNext=function(){var t=this.attrs.state;return h().component({title:"Next",icon:"fa fa-angle-right",className:"Button Button--icon",onclick:function(){var n=t.page().number;t.ctrl.toPage(parseInt(n)+1)},disabled:t.page().number==t.totalPages()})},i.buttonLast=function(){var t=this.attrs.state;return h().component({title:"Last",icon:"fa fa-angle-double-right",className:"Button Button--icon",onclick:function(){var n=parseInt(t.totalPages());t.ctrl.toPage(n)},disabled:t.page().number==t.totalPages()})},i.JumpFunc=function(){var t,n=this.attrs.state,o=parseInt(null==(t=document.getElementById("pagination-inputJump"))?void 0:t.value);Number.isFinite(o)&&Number.isSafeInteger(o)&&o!=n.page().number&&1<=o&&o<=n.totalPages()&&n.ctrl.toPage(o)},i.inputJump=function(){var t=this,n=this.attrs.state;return m("input.FromControl",{id:"pagination-inputJump",placeholder:void 0===n.page().number?"":""+n.page().number,onkeydown:function(n){n.redraw=!1,13==n.keyCode&&(n.redraw=!0,t.JumpFunc())}})},i.buttonJump=function(){return h().component({title:"Jump",icon:"fa fa-paper-plane",className:"Button Button--icon",onclick:this.JumpFunc.bind(this)})},e}(t.n(E)());i().initializers.add("foskym/flarum-pagination",(function(){(0,C.extend)(D().prototype,"oninit",(function(){var t=this.user.preferences();this.userCustom=P()(t["foskym-pagination.userCustom"]),this.userPaginationOnLoading=P()(t["foskym-pagination.userPaginationOnLoading"])})),(0,C.extend)(D().prototype,"settingsItems",(function(t){Boolean(B().forum.attribute("foskym-pagination.canUserPref"))&&t.add("pagination_settings",w().component({label:B().translator.trans("foskym-pagination.forum.user.settings.head"),className:"SettingsPage-pagination"},this.Pagination_UserPrefItems().toArray()))})),D().prototype.Pagination_UserPrefItems=function(){var t=this,n=new(J());return n.add("foskym-pagination.userCustom",F().component({state:this.user.preferences()["foskym-pagination.userCustom"],onchange:function(n){t.UserCustom_Loading=!0,t.user.savePreferences({"foskym-pagination.userCustom":n}).then((function(){t.UserCustom_Loading=!1,m.redraw()}))},loading:this.UserCustom_Loading},B().translator.trans("foskym-pagination.forum.user.settings.userCustom"))),this.user.preferences()["foskym-pagination.userCustom"]&&n.add("foskym-pagination.userPaginationOnLoading",F().component({state:this.user.preferences()["foskym-pagination.userPaginationOnLoading"],onchange:function(n){t.userPaginationOnLoading_Loading=!0,t.user.savePreferences({"foskym-pagination.userPaginationOnLoading":n}).then((function(){t.userPaginationOnLoading_Loading=!1,m.redraw()}))},loading:this.userPaginationOnLoading_Loading},B().translator.trans("foskym-pagination.forum.user.settings.userPaginationOnLoading"))),n},c().prototype.initOptions=function(){this.options={perPage:i().forum.attribute("foskym-pagination.perPage"),perLoadMore:i().forum.attribute("foskym-pagination.perLoadMore"),perIndexInit:i().forum.attribute("foskym-pagination.perIndexInit"),leftEdges:4,rightEdges:5},this.usePaginationMode=function(){if(null===B().session.user)return B().forum.attribute("foskym-pagination.paginationOnLoading");var t=B().session.user.preferences();return B().forum.attribute("foskym-pagination.canUserPref")&&t["foskym-pagination.userCustom"]?!!t["foskym-pagination.userPaginationOnLoading"]:B().forum.attribute("foskym-pagination.paginationOnLoading")}()},(0,a.override)(c().prototype,"refresh",(function(t,n){var o=this;return void 0===n&&(n=1),this.initOptions(),this.usePaginationMode?(this.initialLoading=!0,this.loadingPrev=!1,this.loadingNext=!1,this.clear(),this.location={page:n},this.loadPage(n).then((function(t){o.pages=[],o.parseResults(o.location.page,t)})).finally((function(){o.initialLoading=!1}))):(this.pageSize=this.options.perLoadMore,t(n))})),(0,a.override)(c().prototype,"loadPage",(function(t,n){void 0===n&&(n=1);var e,a,s=this.requestParams(),r=Array.isArray(s.include)?s.include.join(","):s.include;this.usePaginationMode?(e=this.options.perPage*(n-1),a=this.options.perPage):a=0==(e=this.options.perIndexInit*Math.min(n-1,1)+this.options.perLoadMore*Math.max(n-2,0))?this.options.perIndexInit:this.options.perLoadMore;var u=o({},s,{page:o({},s.page,{offset:e,limit:a}),include:r});return i().store.find(this.type,u)})),(0,a.override)(c().prototype,"parseResults",(function(t,n,o){var e;if(!this.usePaginationMode)return t(n,o);var i=Number(n),a=(null==(e=o.payload)?void 0:e.links)||{},s={number:i,items:o,hasNext:!(null==a||!a.next),hasPrev:!(null==a||!a.prev)};this.hasPage=function(t){var n=this.getPages();if(0==n.length)return!1;for(var o=0;o<n.length;o++)if(n[o].number==t)return!0;return!1},this.hasPage(i)||this.pages.push(s),this.location={page:i},this.totalDiscussionCount=P()(o.payload.jsonapi.totalResultsCount),this.getTotalPages=function(){return Math.ceil(this.totalDiscussionCount()/this.options.perPage)},this.page=P()(s),this.perPage=P()(this.options.perPage),this.totalPages=P()(this.getTotalPages()),this.ctrl={prevPage:function(){var t=this,n=this.page().number;if(!(--n<1)){this.page(n);var o=n;this.loadingPrev=!0,this.loadPage(o).then((function(n){t.parseResults(o,n),t.loadingPrev=!1}))}}.bind(this),nextPage:function(){var t=this,n=this.page().number;if(++n>this.totalPages())n=this.totalPages();else{this.page(n);var o=n;this.loadingNext=!0,this.loadPage(o).then((function(n){t.parseResults(o,n),t.loadingNext=!1}))}}.bind(this),toPage:function(t){var n=this;if(!(this.page().number==Number(t)||t<1||t>this.totalPages())){this.page(Number(t));var o=Number(t);this.initialLoading=!0,this.loadPage(o).then((function(t){n.parseResults(o,t),n.initialLoading=!1}))}}.bind(this),pageList:function(){for(var t=[],n=Math.max(parseInt(this.page().number)-this.options.leftEdges,1),o=Math.min(parseInt(this.page().number)+this.options.rightEdges,this.totalPages()),e=n;e<=o;e++)t.push(e);return t}.bind(this)},m.redraw()})),(0,a.override)(c().prototype,"addDiscussion",(function(t){})),(0,a.override)(r().prototype,"view",(function(t){var n=this.attrs.state;if(!n.usePaginationMode)return t();var o=n.getParams(),e=n.isLoading();if(n.isEmpty()){var a=i().translator.trans("core.forum.discussion_list.empty_text");return m("div",{className:"DiscussionList"},m(f(),{text:a}))}if(e)return m("div",{className:I()("DiscussionList",{"DiscussionList--searchResults":n.isSearchResults()})},m("ul",{role:"feed","aria-busy":e,className:"DiscussionList-discussions"}),m("div",{className:"DiscussionList-loadMore"},m(N(),null)));for(var s=n.getPages(),r=[],u=0;u<s.length;u++){var c=s[u];if(c.number==n.location.page){r=c.items;break}}var p=A.component({state:n}),g=i().forum.attribute("foskym-pagination.paginationPosition"),d=n.options.perPage,h=n.page;return m("div",{className:I()("DiscussionList",{"DiscussionList--searchResults":n.isSearchResults()})},"above"==g||"both"==g?p:"",m("ul",{role:"feed","aria-busy":e,className:"DiscussionList-discussions"},r.map((function(t,n){return m("li",{key:t.id(),"data-id":t.id(),role:"article","aria-setsize":"-1","aria-posinset":h*d+n},m(l(),{discussion:t,params:o}))}))),"under"==g||"both"==g?p:"")})),(0,a.extend)(k(),"deleteAction",(function(){if(this.usePaginationMode&&i().discussions){var t=i().discussions.location.page;i().discussions.refresh(t)}})),(0,a.extend)(y().prototype,"onsubmit",(function(){this.usePaginationMode&&i().discussions&&i().discussions.refresh()}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map